<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ø´ÙŠÙ‚</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&family=Fredoka+One&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        .font-heading {
            font-family: 'Fredoka One', cursive;
        }
        .text-shadow-fun {
            text-shadow: 2px 2px 0px rgba(255, 255, 255, 0.7), 4px 4px 0px rgba(0, 0, 0, 0.1);
        }
    </style>

    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX Transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- Custom Hook: useLocalStorage ---
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) { console.log(error); return initialValue; }
            });

            const setValue = (value) => {
                try {
                    const valueToStore = value instanceof Function ? value(storedValue) : value;
                    setStoredValue(valueToStore);
                    window.localStorage.setItem(key, JSON.stringify(valueToStore));
                } catch (error) { console.log(error); }
            };
            return [storedValue, setValue];
        };

        // --- Game Component: GameContainer ---
        // ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„ÙŠØ³ØªØ®Ø¯Ù… "ÙƒÙˆØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø©" Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØ§Ù…Ù„
        const GameContainer = ({ stages, currentStageIndex, onNextStage }) => {
            if (currentStageIndex >= stages.length) {
                return (
                    <div className="text-center p-8 bg-white/80 backdrop-blur-sm rounded-2xl shadow-2xl">
                        <h2 className="text-4xl font-bold text-green-500 mb-4">ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§Ø­Ù„! ğŸ‰</h2>
                    </div>
                );
            }
            const currentStage = stages[currentStageIndex];
            // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
            const gameUrl = `https://wordwall.net/embed/play/${currentStage.code}`;

            return (
                <div className="text-center p-8 bg-white/80 backdrop-blur-sm rounded-2xl shadow-2xl w-full max-w-4xl h-[70vh] flex flex-col">
                    <h2 className="text-3xl font-bold mb-4">Ø§Ù„Ù…Ø±Ø­Ù„Ø© {currentStageIndex + 1}: {currentStage.title}</h2>
                    <iframe 
                        src={gameUrl} 
                        className="w-full h-full border-4 border-purple-300 rounded-lg shadow-inner"
                        frameBorder="0" 
                        allowFullScreen
                    ></iframe>
                    <button 
                        onClick={onNextStage}
                        className="mt-6 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform transform hover:scale-105"
                    >
                        Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
                    </button>
                </div>
            );
        };
        
        // --- Settings Component: StageItem (Ù…ÙƒÙˆÙ† Ø¬Ø¯ÙŠØ¯ Ù„Ø¥Ø¯Ø§Ø±Ø© ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©) ---
        const StageItem = ({ stage, index, onUpdate, onDelete }) => {
            const [isEditing, setIsEditing] = useState(false);
            const [tempStage, setTempStage] = useState(stage);

            const handleSave = () => {
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù„ÙŠØ³Øª ÙØ§Ø±ØºØ© Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸
                if (tempStage.title.trim() === '' || tempStage.code.trim() === '') {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙˆÙƒÙˆØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø©.');
                    return;
                }
                onUpdate(index, tempStage);
                setIsEditing(false);
            };

            const handleCancel = () => {
                setTempStage(stage); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø£ØµÙ„ÙŠØ©
                setIsEditing(false);
            };

            return (
                <div className="p-4 border border-slate-300 rounded-lg bg-slate-50 flex flex-col md:flex-row items-center gap-4">
                    <div className="flex-grow w-full">
                        {isEditing ? (
                            <div className="space-y-3">
                                <input 
                                    type="text"
                                    value={tempStage.title}
                                    onChange={(e) => setTempStage({...tempStage, title: e.target.value})}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500"
                                    placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø©"
                                />
                                <input 
                                    type="text"
                                    value={tempStage.code}
                                    onChange={(e) => setTempStage({...tempStage, code: e.target.value})}
                                    className="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500"
                                    placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù† Ø±Ø§Ø¨Ø· Wordwall"
                                    dir="ltr"
                                />
                            </div>
                        ) : (
                            <div>
                                <h3 className="font-bold text-lg text-purple-800">{stage.title}</h3>
                                <p className="text-sm text-slate-600" dir="ltr">Code: {stage.code}</p>
                            </div>
                        )}
                    </div>
                    <div className="flex-shrink-0 flex items-center gap-2 w-full md:w-auto">
                        {isEditing ? (
                            <>
                                <button onClick={handleSave} className="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg w-full">Ø­ÙØ¸</button>
                                <button onClick={handleCancel} className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg w-full">Ø¥Ù„ØºØ§Ø¡</button>
                            </>
                        ) : (
                            <>
                                <button onClick={() => setIsEditing(true)} className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg w-1/2 md:w-auto">ØªØ¹Ø¯ÙŠÙ„</button>
                                <button onClick={() => onDelete(index)} className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg w-1/2 md:w-auto">Ø­Ø°Ù</button>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // --- Settings Component: SettingsPanel (Ù…ÙØ¹Ø§Ø¯ Ø¨Ù†Ø§Ø¤Ù‡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„) ---
        const SettingsPanel = ({ initialStages, onSave, onBackToGame }) => {
            const [stages, setStages] = useState(initialStages);

            useEffect(() => {
                // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù†Ø¯ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø­Ù„
                onSave(stages);
            }, [stages]);

            const handleAddStage = () => {
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙØ§Ø±ØºØ© ÙˆØ¬Ø¹Ù„Ù‡Ø§ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©
                setStages([...stages, { title: '', code: '', type: 'wordwall' }]);
            };

            const handleDeleteStage = (indexToDelete) => {
                setStages(stages.filter((_, index) => index !== indexToDelete));
            };
            
            const handleUpdateStage = (index, updatedStage) => {
                const newStages = [...stages];
                newStages[index] = updatedStage;
                setStages(newStages);
            };

            return (
                <div className="p-
